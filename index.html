<!DOCTYPE HTML>
<html lang="ru">
<head>
    <title>Three Men in a Boat (To Say Nothing of the Callback)</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=792, user-scalable=no">
    <link rel="stylesheet" href="themes/yandex/styles/screen.css">
    <link rel="stylesheet" href="styles/print.css" media="print">
    <link rel="stylesheet" href="styles/idea.min.css">
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body class="list">

<header class="caption">
    <h1>Three Men in a Boat <br/>(To Say Nothing of the Callback)</h1>
    <p>Zhigalov Sergey, <a href="http://yandex.ru/">Yandex</a></p>
</header>

<section class="slide shout" id="cover">
    <div>
        <h2>Three Men in a Boat <br/>(To Say Nothing of the Callback)</h2>

        <div class="info">
            <p class="author">Zhigalov Sergey</p>
            <p class="location">Frontend Union Conf, 2015</p>
        </div>
    </div>
</section>

<section class="slide">
    <h2>Flights to St. Petersburg</h2>
    <ol>
        <li>Get list of airlines</li>
        <li>Get flight cost</li>
        <li>Sort airlines by cost in ascending order</li>
    </ol>
</section>

<section class="slide section cover">
    <h3>Callback</h3>
    <div style="background-image: url('images/000.png');" class="cover-image"></div>
</section>

<section class="slide">
    <pre class="javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide cover w copyright" style="text-align: center;">
    <img class="myGif" src="images/catIsSad.gif" alt="catIsSad" />
</section>

<section class="slide">
    <pre class="transparent-code javascript" style="margin-top: 10px">
        <code>function getFlights(cb) {</code>
        <code>    <mark>Get list of airlines</mark>(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            <mark>Get flight cost</mark>(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = <mark>Sort airlines</mark>(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>


    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    <mark>Get list of airlines</mark>(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            <mark>Get flight cost</mark>(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = <mark>Sort airlines</mark>(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <pre class="transparent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                <mark>}</mark></code>
        <code>            <mark>})</mark></code>
        <code>        <mark>});</mark></code>
        <code>    <mark>});</mark></code>
        <code><mark>}</mark></code>
    </pre>

    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                <mark>}</mark></code>
        <code>            <mark>})</mark></code>
        <code>        <mark>});</mark></code>
        <code>    <mark>});</mark></code>
        <code><mark>}</mark></code>
    </pre>
</section>

<section class="slide">
    <pre class="transparent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { <mark>return cb(err);</mark> }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    <mark>cb(null, sortedAirlines);</mark></code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>

    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { <mark>return cb(err);</mark> }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    <mark>cb(null, sortedAirlines);</mark></code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <pre class="transparent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        <mark>if (err) { return cb(err); }</mark></code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                <mark>if (err) { return cb(err); }</mark></code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>

    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        <mark>if (err) { return cb(err); }</mark></code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = airlines.length;</code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                <mark>if (err) { return cb(err); }</mark></code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <pre class="transparent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = <mark>airlines.length;</mark></code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, unpaidairlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>

    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        var flightsCost = [];</code>
        <code>        var airlinesCounter = <mark>airlines.length;</mark></code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (--airlinesCounter === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <pre class="transparent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        <mark>var flightsCost = [];</mark></code>
        <code>        <mark>var airlinesCounter = airlines.length;</mark></code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (<mark>--airlinesCounter</mark> === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>

    <pre class="translucent-code javascript">
        <code>function getFlights(cb) {</code>
        <code>    getAirlines(function (err, airlines) {</code>
        <code>        if (err) { return cb(err); }</code>
        <code>        <mark>var flightsCost = [];</mark></code>
        <code>        <mark>var airlinesCounter = airlines.length;</mark></code>
        <code>        airlines.forEach(function (airline, index) {</code>
        <code>            getCost(airline, function (err, cost) {</code>
        <code>                if (err) { return cb(err); }</code>
        <code>                flightsCost[index] = cost;</code>
        <code>                if (<mark>--airlinesCounter</mark> === 0) {</code>
        <code>                    var sortedAirlines = sortAirlines(airlines, flightsCost);</code>
        <code>                    cb(null, sortedAirlines);</code>
        <code>                }</code>
        <code>            })</code>
        <code>        });</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <table style="width: 100%;">
        <thead>
        <tr>
            <th scope="col">Criteria</th>
            <th scope="col">Callback</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>overheads</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>level of nesting</td>
            <td class="bad">5</td>
        </tr>
        <tr>
            <td>visual noise</td>
            <td class="bad">yes</td>
        </tr>
        <tr>
            <td>separation of data and error</td>
            <td class="bad">no</td>
        </tr>
        <tr>
            <td>code duplication</td>
            <td class="bad">yes</td>
        </tr>
        <tr>
            <td>missed error</td>
            <td class="bad">yes</td>
        </tr>
        <tr>
            <td>linear code</td>
            <td class="bad">no</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide section cover">
    <h3>Promises</h3>
    <div style="background-image: url('images/001.png');" class="cover-image"></div>
</section>

<section class="slide">
    <h2>Promises</h2>
    <pre class="javascript">
        <code>myPromise()</code>
        <code>    .then(function onFulfilled() { return data; },</code>
        <code>          function onRejected() { ... })</code>
        <code>    .then(function(data) { ... })</code>
        <code> </code>
    </pre>
    <div style="text-align: center"><img src="images/promiseInit.png" alt="promise" height="180"/></div>
    <p><a href="https://promisesaplus.com/">Promises/A+</a></p>
    <p><a href="https://vimeo.com/74925301">Михаил Давыдов "Promise – это не больно"</a></p>
</section>

<section class="slide">
    <h2><small>Promises.</small> Bluebird</h2>
    <pre class="javascript">
        <code>function myFunction(arg1, arg2, cb) {</code>
        <code>    cb(err, result);</code>
        <code>}</code>
        <code>var myPromisifyFunction = Promise.promisify(myFunction);</code>
        <code> </code>
        <code>myPromisifyFunction()</code>
        <code>    .then(function() { ... })</code>
    </pre>
    <img src="images/bluebird.png" alt="bluebird" style="position: absolute; right: 40px; top: 26px;"/>
    <div style="margin-top: 35px;">
        <p class="github"><a href="https://github.com/petkaantonov/bluebird">petkaantonov/bluebird</a></p>
    </div>
</section>

<section class="slide">
    <h2>Promises</h2>
    <pre class="javascript">
        <code>function getFlights() {</code>
        <code>    return getAirlines()</code>
        <code>        .then(getCosts)</code>
        <code>        .then(sortAirlines)</code>
        <code>        .catch(onReject);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2>Promises</h2>
    <pre class="javascript">
        <code>function getFlights() {</code>
        <code>    return getAirlines()</code>
        <code>        .then(<mark>getCosts</mark>)</code>
        <code>        .then(sortAirlines)</code>
        <code>        .catch(onReject);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Promises.</small> getCosts</h2>
    <pre class="javascript">
        <code>function getCosts(airlines) {</code>
        <code>    return Promise.props({</code>
        <code>        airlines: airlines,</code>
        <code>        flightsCost: Promise.all(airlines.map(getCost))</code>
        <code>    });</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <table style="width: 100%;">
        <thead>
        <tr>
            <th scope="col">Criteria</th>
            <th scope="col">Callback</th>
            <th scope="col">Promises</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>overheads</td>
            <td class="good">no</td>
            <td class="bad">yes</td>
        </tr>
        <tr>
            <td>level of nesting</td>
            <td class="bad">5</td>
            <td class="neutral">2</td>
        </tr>
        <tr>
            <td>visual noise</td>
            <td class="bad">yes</td>
            <td class="neutral">no</td>
        </tr>
        <tr>
            <td>separation of data and error</td>
            <td class="bad">no</td>
            <td class="neutral">yes</td>
        </tr>
        <tr>
            <td>code duplication</td>
            <td class="bad">yes</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>missed error</td>
            <td class="bad">yes</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>linear code</td>
            <td class="bad">no</td>
            <td class="neutral">yes</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Perfect code</h2>
    <pre class="javascript">
        <code>function getFlights() {</code>
        <code>    var airlines = <mark>Get list of airlines</mark>()</code>
        <code>    var flightsCost = airlines.map(<mark>Get flight cost</mark>);</code>
        <code>    return <mark>Sort airlines</mark>(airlines, flightsCost);</code>
        <code>};</code>
    </pre>
</section>

<section class="slide">
    <h2>Perfect code</h2>
    <pre class="javascript">
        <code>function getFlights() {</code>
        <code>    var airlines = getAirlines();</code>
        <code>    var flightsCost = airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Perfect code.</small> Sync</h2>
    <pre class="javascript">
        <code>function getFlights() {</code>
        <code>    var airlines = getAirlines<mark>Sync</mark>();</code>
        <code>    var flightsCost = airlines.map(getCost<mark>Sync</mark>);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Perfect code.</small> Generator</h2>
    <pre class="javascript">
        <code>function <mark>*</mark>getFlights() {</code>
        <code>    var airlines = <mark>yield</mark> getAirlines();</code>
        <code>    var flightsCost = <mark>yield</mark> airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide cover w copyright" style="text-align: center; ">
    <img class="myGif" src="images/catsShock.gif" alt="catsShock" />
</section>

<section class="slide">
    <h2><small>Perfect code.</small> Generator</h2>
    <pre class="javascript">
        <code>co(function *getFlights() {</code>
        <code>    var airlines = yield getAirlines();</code>
        <code>    var flightsCost = yield airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}).then(console.log.bind(console));</code>
    </pre>
</section>

<section class="slide section cover">
    <h3>Generators</h3>
    <div style="background-image: url('images/002.png');" class="cover-image"></div>
</section>

<section class="slide">
    <h2>Generator</h2>
    <blockquote>A generator can pause itself in mid-execution, and can be resumed either right away or at a later
        time.
    </blockquote>
    <p>ES6</p>
</section>

<section class="slide">
    <h2>Generator</h2>
    <blockquote>A generator can pause itself in mid-execution, and can be resumed either right away or at a later
        time.
    </blockquote>
    <p><strike>ES6</strike> ES2015</p>
</section>

<section class="slide">
    <h2><small>Generator.</small> Declaration</h2>
    <pre class="javascript">
        <code>function <mark>*</mark>myGenerator(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> Run</h2>
    <pre class="javascript">
        <code>function *myGenerator(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>myGenerator('Frontend Union Conf');</code>
    </pre>

    <div class="console_port">
        <h3>Console:</h3>
        <pre class="console">
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Iterator</h2>
    <blockquote>An iterator is a structured pattern for pulling information from a source in one-at-a-time fashion.</blockquote>
    <pre class="javascript">
        <code>it.next()</code>
    </pre>

    <div class="console_port">
        <h3>Console:</h3>
        <pre class="console">
            <code>{ value: {...}, done: false}</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Run</h2>
    <pre class="javascript">
        <code>function *myGenerator(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>var it = myGenerator('Frontend Union Conf');</code>
        <code>it.next();</code>
    </pre>

    <div class="console_port">
        <h3>Console:</h3>
        <pre class="console">
            <code>Hello, Frontend Union Conf</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
        <code>console.log(it.next().value);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>1</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>1</code>
            <code>1</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>1</code>
            <code>1</code>
            <code>2</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>1</code>
            <code>1</code>
            <code>2</code>
            <code>3</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>var it = fibonacci();</code>
        <code> </code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
        <code>console.log(it.next().value);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>1</code>
            <code>1</code>
            <code>2</code>
            <code>3</code>
            <code>5</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Fibonacci</h2>
    <pre class="javascript">
        <code>function *fibonacci() {</code>
        <code>    var fn1 = 1;</code>
        <code>    var fn2 = 1;</code>
        <code>    while (true) {</code>
        <code>        var current = fn2;</code>
        <code>        fn2 = fn1;</code>
        <code>        fn1 = fn1 + current;</code>
        <code>        yield current;</code>
        <code>    }</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code>function *fibonacci() {</code>
        <code>    var fn1 = 1;</code>
        <code>    var fn2 = 1;</code>
        <code>    while (true) {</code>
        <code>        var current = fn2;</code>
        <code>        fn2 = fn1;</code>
        <code>        fn1 = fn1 + current;</code>
        <code>        <mark>yield current;</mark></code>
        <code>    }</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code></code>
        <code>function *sum() {</code>
        <code>    var a = yield;</code>
        <code>    var b = yield;</code>
        <code>    console.log(a + b);</code>
        <code>}</code>
        <code>        </code>
        <code>var it = sum();</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>&gt; </code>
            <code> </code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code></code>
        <code>function *sum() {</code>
        <code>    var a = <mark>yield;</mark></code>
        <code>    var b = yield;</code>
        <code>    console.log(a + b);</code>
        <code>}</code>
        <code>        </code>
        <code>var it = sum();</code>
        <code>it.next();</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>&gt; </code>
            <code> </code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code></code>
        <code>function *sum() {</code>
        <code>    var a = <mark>3</mark>;</code>
        <code>    var b = yield;</code>
        <code>    console.log(a + b);</code>
        <code>}</code>
        <code>        </code>
        <code>var it = sum();</code>
        <code>it.next();</code>
        <code>it.next(3);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>&gt; </code>
            <code> </code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code></code>
        <code>function *sum() {</code>
        <code>    var a = 3;</code>
        <code>    var b = <mark>7</mark>;</code>
        <code>    console.log(a + b);</code>
        <code>}</code>
        <code>        </code>
        <code>var it = sum();</code>
        <code>it.next();</code>
        <code>it.next(3);</code>
        <code>it.next(7);</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>10</code>
            <code>&gt; </code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> throw</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    try {</code>
        <code>        yield;</code>
        <code>    } catch (e) {</code>
        <code>        console.error(e.message);</code>
        <code>    }</code>
        <code>} </code>
        <code> </code>
        <code>var it = foo();</code>
        <code>it.next()</code>
        <code>it.throw(new Error('My error!'))</code>
    </pre>

    <div class="console_position console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code><span style="color: #c00 !important">My error!</span></code>
            <code>&gt; </code>
        </pre>
    </div>
</section>

<section class="slide cover w copyright">
    <img src="images/catOnFrozen.jpg" alt="Other way"/>
</section>

<section class="slide">
    <h2>Generator</h2>
    <pre class="javascript">
        <code>function *getFlights() {</code>
        <code>    var airlines = yield getAirlines();</code>
        <code>    var flightsCost = yield airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2>Generator based control flow</h2>
    <ul>
        <li class="github"><a href="https://github.com/kriskowal/q/wiki/API-Reference #qasyncgeneratorfunction">Q.async</a></li>
        <li class="github"><a href="https://github.com/tj/co">tj/co</a></li>
        <li class="github"><a href="https://github.com/mozilla/task.js">task.js</a></li>
        <li class="github"><a href="https://github.com/jmar777/suspend">jmar777/suspend</a></li>
        <li class="github"><a href="https://gist.github.com/jakearchibald/31b89cba627924972ad6">spawn</a></li>
        <li class="github"><a href="https://github.com/then/yield">then-yield</a></li>
        <li>...</li>
    </ul>
</section>

<section class="slide">
    <h2>Generator based control flow</h2>
    <ul>
        <li class="github"><a href="https://github.com/kriskowal/q/wiki/API-Reference #qasyncgeneratorfunction">Q.async</a> ~9400*</li>
        <li class="github"><a href="https://github.com/tj/co">tj/co</a> ~3500*</li>
        <li class="github"><a href="https://github.com/mozilla/task.js">task.js</a> ~1320*</li>
        <li class="github"><a href="https://github.com/jmar777/suspend">jmar777/suspend</a> ~450*</li>
        <li class="github"><a href="https://gist.github.com/jakearchibald/31b89cba627924972ad6">spawn</a> ~20*</li>
        <li class="github"><a href="https://github.com/then/yield">then-yield</a> ~10*</li>
        <li>...</li>
    </ul>
</section>

<section class="slide">
    <h2><small>Generator.</small> co</h2>
    <blockquote>Generator based control flow goodness for nodejs and the browser, using promises,
        letting you write non-blocking code in a nice-ish way.</blockquote>
    <p class="github"><a href="https://github.com/tj/co">tj/co</a></p>
</section>

<section class="slide">
    <h2><small>Generator.</small> co</h2>
    <pre class="javascript">
        <code>var myPromise = co(function* () {</code>
        <code>    var value = yield Promise.resolve('Hello, #func!');</code>
        <code>    return value;</code>
        <code>});</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> co</h2>
    <pre class="javascript">
        <code>var myPromise = co(function* () {</code>
        <code>    var value = yield Promise.resolve('Hello, #func!');</code>
        <code>    return value;</code>
        <code>});</code>
        <code> </code>
        <code>myPromise.then(function (value) {</code>
        <code>    console.log(value);</code>
        <code>});</code>
    </pre>

    <div class="console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>Hello, #func!</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> co.wrap</h2>
    <pre class="javascript">
        <code>var func = co.wrap(function* (name) {</code>
        <code>    var value = yield Promise.resolve(name);</code>
        <code>    return value;</code>
        <code>});</code>
        <code> </code>
        <code>func('Hello, #func!').then(function (value) {</code>
        <code>    console.log(value);</code>
        <code>});</code>
    </pre>

    <div class="console_port" style="top: 143px">
        <h3>Console:</h3>
        <pre class="console">
            <code>Hello, #func!</code>
            <code>&gt;</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2>Generator</h2>
    <pre class="javascript">
        <code>var getFlights = co.wrap(function *() {</code>
        <code>    var airlines = yield getAirlines();</code>
        <code>    var flightsCost = yield airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>});</code>
    </pre>
</section>

<section class="slide">
    <h2>Generator</h2>
    <pre class="javascript">
        <code>var getFlights = co.wrap(function *() {</code>
        <code>    var airlines = yield getAirlines();</code>
        <code>    var flightsCost = yield airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>});</code>
        <code> </code>
        <code>getFlights()</code>
        <code>    .then(console.log.bind(console))</code>
    </pre>
</section>

<section class="slide">
    <table style="width: 100%;">
        <thead>
        <tr>
            <th scope="col">Criteria</th>
            <th scope="col">Callback</th>
            <th scope="col">Promises</th>
            <th scope="col">Generator</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>overheads</td>
            <td class="good">no</td>
            <td class="bad">yes</td>
            <td class="bad">yes</td>
        </tr>
        <tr>
            <td>level of nesting</td>
            <td class="bad">5</td>
            <td class="neutral">2</td>
            <td class="good">1</td>
        </tr>
        <tr>
            <td>visual noise</td>
            <td class="bad">yes</td>
            <td class="neutral">no</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>separation of data and error</td>
            <td class="bad">no</td>
            <td class="good">yes</td>
            <td class="good">yes</td>
        </tr>
        <tr>
            <td>code duplication</td>
            <td class="bad">yes</td>
            <td class="good">no</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>missed error</td>
            <td class="bad">yes</td>
            <td class="good">no</td>
            <td class="good">no</td>
        </tr>
        <tr>
            <td>linear code</td>
            <td class="bad">no</td>
            <td class="neutral">yes</td>
            <td class="good">yes</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Generators framework</h2>
    <ul>
        <li><a href="http://expressjs.com/">Express</a> -> <a href="http://koajs.com/">Koa</a></li>
        <li><a href="http://mochajs.org/">mocha</a> -> <a href="https://github.com/blakeembrey/co-mocha">co-mocha</a></li>
        <li><a href="https://www.npmjs.com/package/monk">monk</a> -> <a href="https://github.com/tj/co-monk">co-monk</a></li>
        <li>fs -> <a href="https://github.com/tj/co-fs">co-fs</a></li>
        <li>spawn -> <a href="https://github.com/tj/co-exec">co-exec</a></li>
        <li>...</li>
    </ul>
</section>

<section class="slide">
    <h2><small>Generator.</small> Support</h2>

    <ul class="custom-list">
        <li class="done">node >=0.11 with --harmony</li>
        <li class="done">iojs</li>
        <li class="pending"><a href="https://clck.ru/9VKMq">Browsers</a>
            <ul class="custom-list">
                <li class="done">Chrome 39.0+</li>
                <li class="done">Firefox 26.0+</li>
                <li class="fail">IE (+ Edge)</li>
                <li class="done">Opera 26+</li>
                <li class="fail">Safari</li>
            </ul>
        </li>
    </ul>
</section>

<section class="slide">
    <h2><small>Generator.</small> Babel</h2>
    <div><a href="https://babeljs.io/">babeljs.io</a></div>
    <img src="images/babel.svg" alt="babel" style="position: absolute; height: 100px; right: 70px; top: 70px;"/>
    <ul class="custom-list">
        <li class="pending">myFile.js -> myFile-compiled.js</li>
        <li class="pending"><a href="https://babeljs.io/docs/setup/">Setup</a></li>
    </ul>
</section>

<section class="slide section cover">
    <h3>async/await</h3>
    <div style="background-image: url('images/003.png');" class="cover-image"></div>
</section>

<section class="slide">
    <h2><small>Perfect code.</small> Async await</h2>
    <pre class="javascript">
        <code><mark>async</mark> function getFlights() {</code>
        <code>    var airlines = <mark>await</mark> getAirlines();</code>
        <code>    var flightsCost = <mark>await</mark> airlines.map(getCost);</code>
        <code>    return sortAirlines(airlines, flightsCost);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Async await.</small> Advantages</h2>
    <ul class="custom-list">
        <li class="done">You use generators as-is</li>
        <li class="done">Semantically code</li>
        <li class="done">Correct operations priority</li>
        <li class="done">Returns promise for frameworks using</li>
    </ul>
</section>

<section class="slide">
    <h2><small>Async await.</small> Traceur</h2>
    <div><a href="http://google.github.io/traceur-compiler/demo/repl.html#%2F%2F%20Options%3A%20--async-functions%0A%0Aasync%20function%20getFlights()%20%7B%0A%20%20%20%20var%20airlines%20%3D%20await%20getAirlines()%3B%0A%20%20%20%20var%20flightsCost%20%3D%20await%20airlines.map(getCost)%3B%0A%20%20%20%20return%20sortAirlines(airlines%2C%20flightsCost)%3B%0A%7D%0A%0AgetFlights()">Traceur</a></div>
    <img src="images/traceur.png" alt="traceur"/>
</section>

<section class="slide">
    <h2>Performance</h2>
    <table style="width: 100%;">
        <thead>
        <tr>
            <th scope="col"> </th>
            <th scope="col">Callback</th>
            <th scope="col">Promise</th>
            <th scope="col">Generator</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Median</td>
            <td>292 ms</td>
            <td>322 ms</td>
            <td>399 ms</td>
        </tr>
        <tr>
            <td>Average</td>
            <td>304 ms</td>
            <td>305 ms</td>
            <td>352 ms</td>
        </tr>
        </tbody>
    </table>
    <p style="font-size: small; color: darkgrey;">* Measured in iojs-3.0 on mac air</p>
</section>


<!--<section class="slide">-->
    <!--<h2>StackTrace</h2>-->
    <!--<a href="https://github.com/chopachom/syncio">syncio</a>-->
<!--</section>-->

<section class="slide shout" id="contacts"><div><h2>Contacts</h2>
    <div class="info">
        <p class="author">Zhigalov Sergey</p>
        <p class="position">Frontend developer</p>

        <div class="contacts">
            <p class="contacts-left contacts-top mail">zhigalov@yandex-team.ru</p>
            <p class="contacts-right contacts-top twitter">@sergey_zhigalov</p>
        </div>
    </div>
</div></section>

<section class="slide" style="text-align: center; font-size: 40px;">
    <p><a href="https://clck.ru/9Ztyr">https://clck.ru/9Ztyr</a></p>
    <img style="margin: 50px;" src="images/qr.png" alt="QR" height="375"/>
</section>

<div class="progress">
    <div></div>
</div>

<script src="js/co.js"></script>
<script src="js/bluebird.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/highlight.min.js"></script>
<script src="js/shower.min.js"></script>
<script src="js/index.js"></script>
<script>
    var getAirlines = Promise.promisify(function getAirlines(cb) {
        console.log('getAirlines start');
        setTimeout(function () {
            console.log('getAirlines end');
            cb(null, ['001', '002', '003', '004', '005', '006', '007', '008', '009', '010']);
        }, 3000);
    });
    var getCost = Promise.promisify(function getCost(airline) {
        var cb = arguments[arguments.length - 1];
        console.log('getCost start', airline);
        setTimeout(function () {
            console.log('getCost end', airline);
            cb(null, Math.random() * 10000);
        }, 5000 * Math.random());
    });
    var sortAirlines = function sortAirlines(airlines, flightsCost) {
        return airlines.sort(function (a, b) {
            return flightsCost[airlines.indexOf(a)] - flightsCost[airlines.indexOf(b)];
        });
    };

    $(function () {
        document.addEventListener('keydown', function(e) {
            try {
                var currentSlideNumber = shower.getCurrentSlideNumber();

                switch (e.which) {
                    case 34: // PgDown
                    case 40: // Down
                    case 39: // Right
                    case 76: // L
                    case 74: // J

                        var gif = $('section').eq(currentSlideNumber).find('.myGif');
                        if (gif) {
                            gif.attr('src', gif.attr('src'))
                        }
                        break;
                }
            } catch (e) {}
        }, false);
    })

</script>
</body>
</html>
